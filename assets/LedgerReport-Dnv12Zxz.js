import{r,C as se,d as le,j as t,S as ne,B as A,n as de,K as re,t as oe}from"./index-D93vVwhB.js";import{c as ie}from"./accounting-tZ5hxOR_.js";import{I as K}from"./Input-C3iYqBmf.js";import{C as ce}from"./Checkbox-Pd8uJytH.js";import{d as me}from"./pdfGenerator-BheaZc2-.js";import{f as ue,g as ge}from"./exportUtils-JZTId_Jh.js";const C=[{id:"date",label:"Date"},{id:"particulars",label:"Particulars"},{id:"voucherType",label:"Vch Type"},{id:"voucherNo",label:"Vch No"},{id:"debit",label:"Debit"},{id:"credit",label:"Credit"},{id:"balance",label:"Balance"}],z={"Sales Accounts":[{id:"partyName",label:"Party Name"},{id:"partyGstin",label:"Party GSTIN"},{id:"taxableAmount",label:"Taxable Amt"},{id:"cgst",label:"CGST"},{id:"sgst",label:"SGST"},{id:"igst",label:"IGST"},{id:"totalValue",label:"Total Value"}],"Purchase Accounts":[{id:"partyName",label:"Party Name"},{id:"partyGstin",label:"Party GSTIN"},{id:"taxableAmount",label:"Taxable Amt"},{id:"cgst",label:"CGST"},{id:"sgst",label:"SGST"},{id:"igst",label:"IGST"},{id:"totalValue",label:"Total Value"}]},je=()=>{var F;const{companyData:y}=r.useContext(se),{startDate:v,endDate:w}=le(),{ledgers:o=[],vouchers:B=[]}=y,[i,J]=r.useState(""),[h,G]=r.useState(v),[T,L]=r.useState(w),[b,Q]=r.useState([]),[f,W]=r.useState(0),[X,R]=r.useState(!1),[N,Y]=r.useState(C),[c,V]=r.useState(C.map(e=>e.id)),j=r.useMemo(()=>new Map(o.map(e=>[e.id,e])),[o]),I=r.useMemo(()=>{var e,l,s;return{cgst:(e=o.find(a=>a.name.toLowerCase()==="cgst"&&a.group==="Duties & Taxes"))==null?void 0:e.id,sgst:(l=o.find(a=>a.name.toLowerCase()==="sgst"&&a.group==="Duties & Taxes"))==null?void 0:l.id,igst:(s=o.find(a=>a.name.toLowerCase()==="igst"&&a.group==="Duties & Taxes"))==null?void 0:s.id}},[o]);r.useEffect(()=>{G(v),L(w),R(!1)},[v,w,i]),r.useEffect(()=>{const e=o.find(s=>s.id===i),l=e?z[e.group]||[]:[];Y([...C,...l]),V([...C.map(s=>s.id),...l.map(s=>s.id)])},[i,o]);const Z=()=>{if(!i)return;const e=j.get(i);if(!e)return;const{openingBalances:l}=ie(o,B,h,new Date().toISOString()),s=l.get(i)||0;W(s);const a=new Date(h),x=new Date(T);x.setHours(23,59,59,999);const u=B.filter(n=>{const m=new Date(n.date);return m>=a&&m<=x&&n.entries.some(S=>S.ledgerId===i)}).sort((n,m)=>new Date(n.date).getTime()-new Date(m.date).getTime());let D=s;const O=[];u.forEach(n=>{var _,$,H,U;const m=n.entries.find(p=>p.ledgerId===i);if(!m)return;const S=m.type==="Dr"?m.amount:0,k=m.type==="Cr"?m.amount:0;D+=S-k;const E=n.entries.find(p=>p.ledgerId!==i),ae=((_=j.get((E==null?void 0:E.ledgerId)||""))==null?void 0:_.name)||n.narration||n.type,g={date:n.date,particulars:ae,voucherType:n.type,voucherNo:n.voucherNo,debit:S,credit:k,balance:D};if(z[e.group]){const p=n.entries.find(d=>{var q;return["Sundry Debtors","Sundry Creditors"].includes(((q=j.get(d.ledgerId))==null?void 0:q.group)||"")});if(p){const d=j.get(p.ledgerId);g.partyName=d==null?void 0:d.name,g.partyGstin=d==null?void 0:d.gstNo,g.totalValue=p.amount}g.taxableAmount=m.amount,g.cgst=(($=n.entries.find(d=>d.ledgerId===I.cgst))==null?void 0:$.amount)||0,g.sgst=((H=n.entries.find(d=>d.ledgerId===I.sgst))==null?void 0:H.amount)||0,g.igst=((U=n.entries.find(d=>d.ledgerId===I.igst))==null?void 0:U.amount)||0}O.push(g)}),Q(O),R(!0)},ee=e=>{V(l=>l.includes(e)?l.filter(s=>s!==e):[...l,e])},M=e=>{const l=o.find(a=>a.id===i);if(!l||!y)return;const s=N.filter(a=>c.includes(a.id));if(b.map(a=>{const x={};return s.forEach(u=>{x[u.label]=a[u.id]}),x}),e==="pdf")me(l,b,s,f,h,T,y);else{const a=s.map(u=>u.label),x=b.map(u=>s.map(D=>u[D.id]??""));ge(a,x,`Ledger_${l.name.replace(/ /g,"_")}`)}},P=b.length>0?b[b.length-1].balance:f,te=r.useMemo(()=>[{value:"",label:"-- Select a Ledger --"},...o.map(e=>({value:e.id,label:e.name}))],[o]);return t.jsxs("div",{className:"container mx-auto",children:[t.jsx("h1",{className:"text-3xl font-bold text-slate-100 mb-6",children:"Ledger Report"}),t.jsx("div",{className:"bg-slate-800 p-6 rounded-lg shadow-lg border border-slate-700 mb-8",children:t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 items-end",children:[t.jsx("div",{className:"md:col-span-2",children:t.jsx(ne,{label:"Select Ledger",id:"ledger",value:i,onChange:J,options:te,required:!0})}),t.jsx(K,{label:"From Date",id:"fromDate",type:"date",value:h,onChange:e=>G(e.target.value)}),t.jsx(K,{label:"To Date",id:"toDate",type:"date",value:T,onChange:e=>L(e.target.value)}),t.jsx("div",{className:"md:col-start-4",children:t.jsxs(A,{onClick:Z,disabled:!i,className:"w-full",children:[t.jsx(de,{className:"w-5 h-5 mr-2"})," View Report"]})})]})}),X&&t.jsxs("div",{children:[t.jsxs("div",{className:"bg-slate-800 p-4 rounded-lg shadow-lg border border-slate-700 mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-slate-200 mb-3",children:"Report Options"}),t.jsxs("div",{className:"mb-4",children:[t.jsx("p",{className:"text-sm font-medium text-slate-400 mb-2",children:"Select Columns:"}),t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3",children:N.map(e=>t.jsx(ce,{id:`col-${e.id}`,label:e.label,checked:c.includes(e.id),onChange:()=>ee(e.id)},e.id))})]}),t.jsxs("div",{className:"flex justify-end gap-4 border-t border-slate-700 pt-4",children:[t.jsxs(A,{onClick:()=>M("csv"),variant:"secondary",children:[t.jsx(re,{className:"w-5 h-5 mr-2"})," Export to Excel"]}),t.jsxs(A,{onClick:()=>M("pdf"),variant:"secondary",children:[t.jsx(oe,{className:"w-5 h-5 mr-2"})," Export to PDF"]})]})]}),t.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4 gap-4",children:t.jsxs("h2",{className:"text-xl font-bold text-sky-300",children:["Statement for: ",(F=o.find(e=>e.id===i))==null?void 0:F.name]})}),t.jsx("div",{className:"bg-slate-800 rounded-lg shadow-lg overflow-hidden border border-slate-700",children:t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full text-sm",children:[t.jsx("thead",{className:"text-left text-slate-400 bg-slate-900/50",children:t.jsx("tr",{children:N.filter(e=>c.includes(e.id)).map(e=>t.jsx("th",{className:"p-3 font-medium",children:e.label},e.id))})}),t.jsxs("tbody",{children:[t.jsxs("tr",{className:"border-b border-slate-700",children:[t.jsx("td",{colSpan:c.includes("balance")?c.indexOf("balance"):c.length,className:"p-3 font-bold text-slate-300",children:"Opening Balance"}),c.includes("balance")&&t.jsxs("td",{className:"p-3 text-right font-bold font-mono text-slate-300",children:[Math.abs(f).toFixed(2)," ",f>=0?"Dr":"Cr"]})]}),b.map((e,l)=>t.jsx("tr",{className:"border-b border-slate-700/50 hover:bg-slate-700/30",children:N.filter(s=>c.includes(s.id)).map(s=>{let a=e[s.id];return typeof a=="number"&&(a=a.toFixed(2)),s.id==="balance"&&(a=`${Math.abs(e.balance).toFixed(2)} ${e.balance>=0?"Dr":"Cr"}`),s.id==="date"&&(a=ue(a)),t.jsx("td",{className:"p-3 font-mono",children:a},s.id)})},l))]}),t.jsx("tfoot",{className:"bg-slate-900/50 font-bold",children:t.jsxs("tr",{children:[t.jsx("td",{colSpan:c.includes("balance")?c.indexOf("balance"):c.length,className:"p-3 text-slate-300",children:"Closing Balance"}),c.includes("balance")&&t.jsxs("td",{className:"p-3 text-right font-mono text-slate-200",children:[Math.abs(P).toFixed(2)," ",P>=0?"Dr":"Cr"]})]})})]})})})]})]})};export{je as default};
