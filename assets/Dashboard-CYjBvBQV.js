import{j as e,r as k,C as A,c as W,B as E,d as X,e as H}from"./index-D93vVwhB.js";import{c as V,a as q,b as G}from"./accounting-tZ5hxOR_.js";import{f as O}from"./exportUtils-JZTId_Jh.js";import{C as J}from"./Checkbox-Pd8uJytH.js";const Q=({title:l,value:o,currency:a,period:f,color:n,isBalance:t=!1})=>{const r={green:"border-green-500/50 text-green-700 dark:text-green-300",orange:"border-orange-500/50 text-orange-700 dark:text-orange-300",sky:"border-sky-500/50 text-sky-700 dark:text-sky-300",blue:"border-blue-500/50 text-blue-700 dark:text-blue-300",red:"border-red-500/50 text-red-700 dark:text-red-300"},u=t&&o<0?"Cr":t?"Dr":"";return e.jsxs("div",{className:`bg-white dark:bg-slate-800/70 p-5 rounded-lg border-l-4 shadow-lg ${r[n]}`,children:[e.jsx("p",{className:"text-sm font-medium text-slate-500 dark:text-slate-400",children:l}),e.jsxs("p",{className:"text-3xl font-bold mt-2",children:[a," ",Math.abs(o).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2}),t&&e.jsx("span",{className:"text-lg ml-2 font-medium text-slate-400 dark:text-slate-500",children:u})]}),e.jsx("p",{className:"text-xs text-slate-400 dark:text-slate-500 mt-2",children:f})]})},U=({data:l,currency:o})=>{const[a,f]=k.useState({visible:!1,content:"",x:0,y:0});if(!l||l.length===0)return e.jsx("div",{className:"text-center p-4 bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 h-full flex items-center justify-center text-slate-500",children:"No sales data for this period."});const n=500,t=200,r=20,u=Math.min(...l.map(s=>s.value),0),h=Math.max(...l.map(s=>s.value),0),d=h-u===0?1:h-u,x=s=>r+s/(l.length-1)*(n-2*r),b=s=>t-r-(s-u)/d*(t-2*r),g=l.map((s,m)=>`${m===0?"M":"L"} ${x(m)} ${b(s.value)}`).join(" "),c=b(0),p=(s,m)=>{const N=s.currentTarget.getBoundingClientRect();f({visible:!0,content:`${m.label}: ${o} ${m.value.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})}`,x:N.left+N.width/2,y:N.top-10})},v=()=>{f({...a,visible:!1})};return e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 sm:p-6 rounded-lg border border-slate-200 dark:border-slate-700 h-full flex flex-col min-h-[350px]",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-slate-200 mb-4",children:"Monthly Sales"}),e.jsxs("div",{className:"flex-grow flex flex-col",children:[e.jsx("div",{className:"relative flex-grow",children:e.jsxs("svg",{viewBox:`0 0 ${n} ${t}`,className:"w-full h-full",onMouseOut:v,children:[e.jsx("line",{x1:r,y1:c,x2:n-r,y2:c,strokeDasharray:"3 3",className:"stroke-slate-300 dark:stroke-slate-600",strokeWidth:"1"}),e.jsx("path",{d:g,fill:"none",className:"stroke-sky-500 dark:stroke-sky-400",strokeWidth:"2"}),l.map((s,m)=>e.jsx("circle",{cx:x(m),cy:b(s.value),r:"4",className:"fill-sky-500 dark:fill-sky-400 stroke-white dark:stroke-slate-800",strokeWidth:"2",onMouseOver:j=>p(j,s),"aria-label":`Sales for ${s.label}: ${s.value}`,role:"figure"},m))]})}),e.jsx("div",{className:"flex justify-around text-xs text-slate-500 dark:text-slate-400 mt-2",children:l.map(s=>e.jsx("span",{className:"flex-1 text-center",children:s.label},s.label))})]}),a.visible&&e.jsx("div",{className:"fixed z-10 p-2 text-xs font-semibold text-white bg-slate-900/80 border border-slate-600 rounded-md shadow-lg pointer-events-none",style:{transform:"translate(-50%, -100%)",left:a.x,top:a.y},children:a.content})]})},Z=({data:l,currency:o})=>{const[a,f]=k.useState({visible:!1,content:"",x:0,y:0});if(!l||l.length===0)return e.jsx("div",{className:"text-center p-4 bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 h-full flex items-center justify-center text-slate-500",children:"No profit data for this period."});const n=500,t=200,r=20,u=Math.min(...l.map(s=>s.value),0),h=Math.max(...l.map(s=>s.value),0),d=h-u===0?1:h-u,x=s=>r+s/(l.length-1)*(n-2*r),b=s=>t-r-(s-u)/d*(t-2*r),g=l.map((s,m)=>`${m===0?"M":"L"} ${x(m)} ${b(s.value)}`).join(" "),c=b(0),p=(s,m)=>{const N=s.currentTarget.getBoundingClientRect();f({visible:!0,content:`${m.label}: ${o} ${m.value.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})}`,x:N.left+N.width/2,y:N.top-10})},v=()=>{f({...a,visible:!1})};return e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 sm:p-6 rounded-lg border border-slate-200 dark:border-slate-700 h-full flex flex-col min-h-[350px]",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-slate-200 mb-4",children:"Monthly Profit / Loss"}),e.jsxs("div",{className:"flex-grow flex flex-col",children:[e.jsx("div",{className:"relative flex-grow",children:e.jsxs("svg",{viewBox:`0 0 ${n} ${t}`,className:"w-full h-full",onMouseOut:v,children:[e.jsx("line",{x1:r,y1:c,x2:n-r,y2:c,strokeDasharray:"3 3",className:"stroke-slate-300 dark:stroke-slate-600",strokeWidth:"1"}),e.jsx("path",{d:g,fill:"none",className:"stroke-sky-500 dark:stroke-sky-400",strokeWidth:"2"}),l.map((s,m)=>e.jsx("circle",{cx:x(m),cy:b(s.value),r:"4",className:`${s.value>=0?"fill-sky-500 dark:fill-sky-400":"fill-red-500 dark:fill-red-500"} stroke-white dark:stroke-slate-800`,strokeWidth:"2",onMouseOver:j=>p(j,s),"aria-label":`Profit for ${s.label}: ${s.value}`,role:"figure"},m))]})}),e.jsx("div",{className:"flex justify-around text-xs text-slate-500 dark:text-slate-400 mt-2",children:l.map(s=>e.jsx("span",{className:"flex-1 text-center",children:s.label},s.label))})]}),a.visible&&e.jsx("div",{className:"fixed z-10 p-2 text-xs font-semibold text-white bg-slate-900/80 border border-slate-600 rounded-md shadow-lg pointer-events-none",style:{transform:"translate(-50%, -100%)",left:a.x,top:a.y},children:a.content})]})},_=({data:l,currency:o})=>{var g;const[a,f]=k.useState({visible:!1,content:"",x:0,y:0}),n=l.reduce((c,p)=>c+p.value,0);if(n===0)return e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 sm:p-6 rounded-lg border border-slate-200 dark:border-slate-700 h-full flex flex-col min-h-[350px]",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-slate-200 mb-4",children:"Income vs Expense"}),e.jsx("div",{className:"flex-grow flex items-center justify-center",children:e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"No data for this period."})})]});const t=180,r=25,u=(t-r)/2,h=2*Math.PI*u;let d=0;const x=(c,p)=>{const v=c.currentTarget.getBoundingClientRect(),s=(p.value/n*100).toFixed(1);f({visible:!0,content:`${p.label}: ${s}% (${o} ${p.value.toLocaleString("en-IN")})`,x:v.left+v.width/2,y:v.top-10})},b=()=>{f({...a,visible:!1})};return e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 sm:p-6 rounded-lg border border-slate-200 dark:border-slate-700 h-full flex flex-col min-h-[350px]",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-slate-200 mb-4",children:"Income vs Expense"}),e.jsxs("div",{className:"flex-grow flex flex-col md:flex-row items-center justify-center gap-6",children:[e.jsx("div",{className:"relative",onMouseOut:b,children:e.jsxs("svg",{width:t,height:t,viewBox:`0 0 ${t} ${t}`,children:[e.jsx("circle",{className:"stroke-slate-200 dark:stroke-slate-700",cx:t/2,cy:t/2,r:u,strokeWidth:r,fill:"transparent"}),l.map((c,p)=>{const v=h-d/360*h,s=c.value/n*360,m=`${s/360*h} ${h}`;return d+=s,e.jsx("circle",{cx:t/2,cy:t/2,r:u,strokeWidth:r,fill:"transparent",stroke:c.color,strokeDasharray:m,strokeDashoffset:v,transform:`rotate(-90 ${t/2} ${t/2}) rotate(${d-s} ${t/2} ${t/2})`,className:"transition-all duration-300",onMouseOver:j=>x(j,c)},p)}),e.jsxs("text",{x:"50%",y:"50%",dominantBaseline:"middle",textAnchor:"middle",className:"fill-slate-800 dark:fill-slate-200 text-lg font-bold",children:[((((g=l.find(c=>c.label==="Income"))==null?void 0:g.value)||0)/n*100).toFixed(0),"%"]}),e.jsx("text",{x:"50%",y:"65%",dominantBaseline:"middle",textAnchor:"middle",className:"fill-slate-500 dark:fill-slate-400 text-xs",children:"Income"})]})}),e.jsx("div",{className:"space-y-2",children:l.map(c=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:c.color}}),e.jsx("span",{className:"text-slate-700 dark:text-slate-300",children:c.label}),e.jsxs("span",{className:"font-mono text-slate-800 dark:text-slate-200",children:[o," ",c.value.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]})]},c.label))})]}),a.visible&&e.jsx("div",{className:"fixed z-10 p-2 text-xs font-semibold text-white bg-slate-900/80 border border-slate-600 rounded-md shadow-lg pointer-events-none",style:{transform:"translate(-50%, -100%)",left:a.x,top:a.y},children:a.content})]})},z=({ledgers:l,vouchers:o,startDate:a,endDate:f,type:n,currency:t})=>{const r=`Sundry ${n}`,u=k.useMemo(()=>{const{closingBalances:h}=V(l,o,a,f);return l.filter(d=>d.group===r).map(d=>({name:d.name,balance:h.get(d.id)||0})).filter(d=>Math.abs(d.balance)>.01).sort((d,x)=>Math.abs(x.balance)-Math.abs(d.balance)).slice(0,5)},[l,o,a,f,r]);return e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 sm:p-6 rounded-lg border border-slate-200 dark:border-slate-700 h-full flex flex-col min-h-[350px]",children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-800 dark:text-slate-200 mb-4",children:["Top 5 ",n]}),u.length>0?e.jsx("ul",{className:"space-y-3 flex-grow",children:u.map(h=>e.jsxs("li",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-slate-700 dark:text-slate-300 truncate pr-4",children:h.name}),e.jsxs("span",{className:"font-mono font-semibold text-slate-800 dark:text-slate-200 whitespace-nowrap",children:[t," ",Math.abs(h.balance).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]})]},h.name))}):e.jsx("div",{className:"flex-grow flex items-center justify-center",children:e.jsxs("p",{className:"text-slate-500 dark:text-slate-400",children:["No outstanding ",n.toLowerCase()," for this period."]})})]})},ee=()=>{const l=k.useContext(A);if(!l||!l.companyData)return null;const{companyData:o,updateDashboardLayout:a}=l,{hideModal:f}=W(),n=o.dashboardLayout||[{id:"sales",visible:!0},{id:"purchases",visible:!0},{id:"cash",visible:!0},{id:"debtors",visible:!0},{id:"creditors",visible:!0}],[t,r]=k.useState(n),u={sales:"Total Sales",purchases:"Total Purchases",cash:"Cash & Bank",debtors:"Sundry Debtors",creditors:"Sundry Creditors"},h=x=>{r(b=>b.map(g=>g.id===x?{...g,visible:!g.visible}:g))},d=()=>{a(t),f()};return e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-slate-100 mb-4",children:"Customize Dashboard KPIs"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-6",children:"Select which Key Performance Indicators to display on your dashboard. Drag and drop to reorder (feature coming soon)."}),e.jsx("div",{className:"space-y-4",children:t.map(x=>e.jsx("div",{className:"flex items-center p-3 bg-slate-100 dark:bg-slate-700/50 rounded-md",children:e.jsx(J,{id:`kpi-${x.id}`,label:u[x.id]||x.id,checked:x.visible,onChange:()=>h(x.id)})},x.id))}),e.jsxs("div",{className:"mt-6 flex justify-end gap-4",children:[e.jsx(E,{variant:"secondary",onClick:f,children:"Cancel"}),e.jsx(E,{onClick:d,children:"Save Changes"})]})]})},oe=()=>{const{companyData:l}=k.useContext(A),{startDate:o,endDate:a}=X(),{showModal:f}=W(),{details:n,ledgers:t,vouchers:r,stockItems:u,salesmen:h,dashboardLayout:d}=l,x=k.useMemo(()=>{if(!o||!a)return[];const i=new Date(o),w=new Date(a);return w.setHours(23,59,59,999),r.filter(D=>{const M=new Date(D.date);return M>=i&&M<=w})},[r,o,a]),b=k.useMemo(()=>!l||!o||!a?[]:q(t,r,o,a),[l,o,a,t,r]),g=k.useMemo(()=>b.map(i=>({label:i.name,value:i.sales})),[b]),c=k.useMemo(()=>b.map(i=>({label:i.name,value:i.profit})),[b]),{totalSales:p,totalPurchases:v,cashBankBalance:s,sundryDebtors:m,sundryCreditors:j,incomeExpenseData:N}=k.useMemo(()=>{const{transactions:i,closingBalances:w}=V(t,r,o,a);let D=0,M=0,P=0,I=0,F=0;t.forEach(y=>{const C=w.get(y.id)||0;y.group==="Bank Accounts"||y.group==="Cash-in-hand"?P+=C:y.group==="Sundry Debtors"?I+=C:y.group==="Sundry Creditors"&&(F-=C)});const{totalIncome:Y,totalExpense:K}=G(t,i);return x.forEach(y=>{var C,T;y.type==="Sale"?D+=((C=y.entries.find(S=>{var $;return(($=t.find(B=>B.id===S.ledgerId))==null?void 0:$.group)==="Sales Accounts"}))==null?void 0:C.amount)||0:y.type==="Purchase"&&(M+=((T=y.entries.find(S=>{var $;return(($=t.find(B=>B.id===S.ledgerId))==null?void 0:$.group)==="Purchase Accounts"}))==null?void 0:T.amount)||0)}),{totalSales:D,totalPurchases:M,cashBankBalance:P,sundryDebtors:I,sundryCreditors:F,incomeExpenseData:[{label:"Income",value:Y,color:"#34d399"},{label:"Expense",value:K,color:"#f87171"}]}},[x,t,r,o,a]);if(!o||!a)return e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"text-xl text-slate-600 dark:text-slate-300",children:"Loading financial period..."})});const L=[{id:"sales",title:"Total Sales",value:p,period:"for the period",color:"green",isBalance:!1},{id:"purchases",title:"Total Purchases",value:v,period:"for the period",color:"orange",isBalance:!1},{id:"cash",title:"Cash & Bank",value:s,period:"as on date",color:"sky",isBalance:!0},{id:"debtors",title:"Sundry Debtors",value:m,period:"receivables as on date",color:"blue",isBalance:!0},{id:"creditors",title:"Sundry Creditors",value:j,period:"payables as on date",color:"red",isBalance:!0}],R=k.useMemo(()=>(d||[]).map(i=>{const w=L.find(D=>D.id===i.id);return w?{...w,visible:i.visible}:null}).filter(i=>i&&i.visible),[d,L]);return e.jsxs("div",{className:"container mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-start mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-slate-100",children:"Dashboard"}),e.jsxs("p",{className:"text-lg text-slate-500 dark:text-slate-400 mt-1",children:["Financial overview for ",e.jsx("span",{className:"font-semibold text-sky-500 dark:text-sky-400",children:O(o)})," to ",e.jsx("span",{className:"font-semibold text-sky-500 dark:text-sky-400",children:O(a)}),"."]})]}),e.jsx("button",{onClick:()=>f(e.jsx(ee,{})),title:"Customize Dashboard",className:"p-2 rounded-md text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors",children:e.jsx(H,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-6 mb-6",children:R.map(i=>i&&e.jsx(Q,{title:i.title,value:i.value,currency:n.currencySymbol,period:i.period,color:i.color,isBalance:i.isBalance},i.id))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(U,{data:g,currency:n.currencySymbol}),e.jsx(Z,{data:c,currency:n.currencySymbol})]}),e.jsx(_,{data:N,currency:n.currencySymbol})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6",children:[e.jsx(z,{ledgers:t,vouchers:r,startDate:o,endDate:a,type:"Debtors",currency:n.currencySymbol}),e.jsx(z,{ledgers:t,vouchers:r,startDate:o,endDate:a,type:"Creditors",currency:n.currencySymbol})]})]})};export{oe as default};
