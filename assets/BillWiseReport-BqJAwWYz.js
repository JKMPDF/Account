import{r as d,C as A,j as e,S as E,B as T,n as F}from"./index-D93vVwhB.js";import{I as M}from"./Input-C3iYqBmf.js";import{f as j}from"./exportUtils-JZTId_Jh.js";const L=()=>{var p;const{companyData:N}=d.useContext(A),{ledgers:i,vouchers:x}=N,[a,b]=d.useState(""),[u,D]=d.useState(new Date().toISOString().split("T")[0]),[c,y]=d.useState([]),[v,w]=d.useState(!1),S=d.useMemo(()=>[{value:"",label:"Select Party"},...i.filter(t=>(t.group==="Sundry Debtors"||t.group==="Sundry Creditors")&&t.isBillWise).map(t=>({value:t.id,label:t.name}))],[i]),k=()=>{if(!a)return;const t=i.find(s=>s.id===a);if(!t)return;const n=new Date(u),O=x.filter(s=>(s.type==="Sale"||s.type==="Purchase")&&new Date(s.date)<=n&&s.entries.some(r=>r.ledgerId===a)),B=x.filter(s=>["Payment","Receipt","Credit Note","Debit Note"].includes(s.type)&&new Date(s.date)<=n&&s.entries.some(r=>r.ledgerId===a)),h=new Map;B.forEach(s=>{s.entries.forEach(r=>{var l;(l=r.billAllocations)==null||l.forEach(o=>{h.set(o.invoiceId,(h.get(o.invoiceId)||0)+o.amount)})})});const R=O.map(s=>{var f;const r=((f=s.entries.find(P=>P.ledgerId===a))==null?void 0:f.amount)||0,l=h.get(s.id)||0,o=r-l,C=t.creditPeriod||0,m=new Date(s.date);m.setDate(m.getDate()+C);const g=o>.01?Math.floor((n.getTime()-m.getTime())/(1e3*3600*24)):0;return{id:s.id,date:s.date,voucherNo:s.voucherNo,amount:r,paid:l,balance:o,dueDate:m.toISOString().split("T")[0],overdueDays:g>0?g:0}}).filter(s=>s.balance>.01);y(R),w(!0)},I=d.useMemo(()=>c.reduce((t,n)=>t+n.balance,0),[c]);return e.jsxs("div",{className:"container mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-slate-100 mb-6",children:"Bill-wise Outstanding Report"}),e.jsx("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-lg shadow-lg border border-slate-200 dark:border-slate-700 mb-8",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx(E,{label:"Select Party",id:"party",value:a,onChange:b,options:S,required:!0})}),e.jsx(M,{label:"As on Date",id:"asOnDate",type:"date",value:u,onChange:t=>D(t.target.value)}),e.jsx("div",{className:"md:col-start-3",children:e.jsxs(T,{onClick:k,disabled:!a,className:"w-full",children:[e.jsx(F,{className:"w-5 h-5 mr-2"})," View Report"]})})]})}),v&&e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-lg overflow-hidden border border-slate-200 dark:border-slate-700",children:[e.jsx("div",{className:"p-4",children:e.jsxs("h2",{className:"text-xl font-bold text-sky-500 dark:text-sky-400",children:["Outstanding for: ",(p=i.find(t=>t.id===a))==null?void 0:p.name]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"text-left text-slate-500 dark:text-slate-400 bg-slate-100 dark:bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 font-medium",children:"Bill Date"}),e.jsx("th",{className:"p-3 font-medium",children:"Bill No."}),e.jsx("th",{className:"p-3 font-medium",children:"Due Date"}),e.jsx("th",{className:"p-3 font-medium text-right",children:"Bill Amount"}),e.jsx("th",{className:"p-3 font-medium text-right",children:"Received/Paid"}),e.jsx("th",{className:"p-3 font-medium text-right",children:"Balance"}),e.jsx("th",{className:"p-3 font-medium text-right",children:"Overdue Days"})]})}),e.jsx("tbody",{children:c.length>0?c.map(t=>e.jsxs("tr",{className:"border-b border-slate-200 dark:border-slate-700/50 hover:bg-slate-50 dark:hover:bg-slate-700/30",children:[e.jsx("td",{className:"p-3",children:j(t.date)}),e.jsx("td",{className:"p-3",children:t.voucherNo}),e.jsx("td",{className:"p-3",children:j(t.dueDate)}),e.jsx("td",{className:"p-3 text-right font-mono",children:t.amount.toFixed(2)}),e.jsx("td",{className:"p-3 text-right font-mono",children:t.paid.toFixed(2)}),e.jsx("td",{className:"p-3 text-right font-mono font-bold",children:t.balance.toFixed(2)}),e.jsx("td",{className:`p-3 text-right font-mono ${t.overdueDays>0?"text-red-500 font-semibold":""}`,children:t.overdueDays})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center p-8 text-slate-500",children:"No outstanding bills found for this party."})})}),e.jsx("tfoot",{className:"bg-slate-100 dark:bg-slate-900/50 font-bold",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:5,className:"p-3 text-slate-800 dark:text-slate-200",children:"Total Outstanding"}),e.jsx("td",{className:"p-3 text-right font-mono text-lg",children:I.toFixed(2)}),e.jsx("td",{})]})})]})})]})]})};export{L as default};
