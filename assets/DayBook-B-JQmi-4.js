import{u as G,r as c,C as J,d as R,c as H,j as e,n as U,B as m,t as q,o as S,E as K,p as O}from"./index-D93vVwhB.js";import{I as C}from"./Input-C3iYqBmf.js";import{C as T}from"./Checkbox-Pd8uJytH.js";import{a as Q}from"./pdfGenerator-BheaZc2-.js";import{f as W}from"./exportUtils-JZTId_Jh.js";const se=()=>{const V=G(),j=c.useContext(J),{startDate:N,endDate:b,setSelectedFY:M}=R(),{showModal:A,hideModal:w}=H(),[x,I]=c.useState(""),[r,h]=c.useState(new Set),[o,F]=c.useState("");if(!j)return e.jsx("div",{className:"text-center p-10",children:"Loading..."});const{companyData:g,deleteVoucher:E}=j;if(!g)return e.jsx("div",{className:"text-center p-10",children:"Loading company data..."});const{vouchers:p=[],ledgers:k=[]}=g,u=c.useMemo(()=>new Map(k.map(t=>[t.id,t.name])),[k]),i=c.useMemo(()=>{const t=new Date(N),s=new Date(b);s.setHours(23,59,59,999);let l=p.filter(a=>{const d=new Date(a.date);return d>=t&&d<=s}).sort((a,d)=>new Date(d.date).getTime()-new Date(a.date).getTime()||d.voucherNo-a.voucherNo);if(o&&(l=l.filter(a=>a.date===o)),!x)return l;const n=x.toLowerCase();return l.filter(a=>{var v,D;const d=a.entries.some(f=>(u.get(f.ledgerId)||"").toLowerCase().includes(n)),P=((v=a.entries.find(f=>f.type==="Dr"))==null?void 0:v.amount.toString())||"0";return((D=a.narration)==null?void 0:D.toLowerCase().includes(n))||a.voucherNo.toString().includes(n)||P.includes(n)||d})},[p,N,b,x,o,u]),L=()=>{if(!o)return;const t=new Date(o),s=t.getFullYear(),n=t.getMonth()>=3?s:s-1,a=`${n}-${(n+1).toString().slice(2)}`;M(a)},$=t=>{h(s=>{const l=new Set(s);return l.has(t)?l.delete(t):l.add(t),l})},z=()=>{r.size===i.length?h(new Set):h(new Set(i.map(t=>t.id)))},B=()=>{const t=p.filter(s=>r.has(s.id));t.length>0&&g&&Q(t,g)},Y=t=>V("/post-entry",{state:{voucherId:t}}),y=t=>{const s=t.length===1?"Are you sure you want to delete this voucher?":`Are you sure you want to delete ${t.length} selected vouchers?`;A(e.jsx(O,{title:"Delete Voucher(s)",message:s,onConfirm:()=>{E(t),h(new Set),w()},onCancel:w,confirmText:"Delete",confirmVariant:"danger"}))};return e.jsxs("div",{className:"container mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-slate-100 mb-6",children:"Day Book"}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 rounded-lg shadow-md border border-slate-200 dark:border-slate-700 mb-6 flex flex-col md:flex-row gap-4 justify-between items-center",children:[e.jsxs("div",{className:"relative w-full md:w-72",children:[e.jsx(C,{label:"",id:"search-daybook",type:"text",placeholder:"Search...",value:x,onChange:t=>I(t.target.value),className:"!pl-10"}),e.jsx(U,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx(C,{label:"Go to Date",id:"jump-date",type:"date",value:o,onChange:t=>F(t.target.value)}),e.jsx(m,{onClick:L,variant:"secondary",children:"Go"})]})]}),r.size>0&&e.jsxs("div",{className:"bg-sky-100 dark:bg-sky-900/50 p-3 rounded-lg mb-6 flex justify-between items-center",children:[e.jsxs("span",{className:"font-semibold text-sky-800 dark:text-sky-200",children:[r.size," voucher(s) selected"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{onClick:B,variant:"secondary",children:[e.jsx(q,{className:"w-5 h-5 mr-2"})," Download Selected"]}),e.jsxs(m,{onClick:()=>y(Array.from(r)),variant:"danger",children:[e.jsx(S,{className:"w-5 h-5 mr-2"})," Delete Selected"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-lg overflow-hidden border border-slate-200 dark:border-slate-700",children:[e.jsx("div",{className:"p-4 border-b border-slate-200 dark:border-slate-700",children:e.jsx(T,{id:"select-all",label:"Select All Visible",checked:r.size===i.length&&i.length>0,onChange:z})}),i.length>0?e.jsx("div",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:i.map(t=>e.jsxs("div",{className:"p-4 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors duration-200 group flex gap-4",children:[e.jsx(T,{id:`select-${t.id}`,label:"",checked:r.has(t.id),onChange:()=>$(t.id),className:"mt-2"}),e.jsxs("div",{className:"flex-grow",children:[e.jsxs("div",{className:"flex justify-between items-start gap-4 mb-3 pb-3 border-b border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 flex-grow",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-slate-500 dark:text-slate-400 text-sm",children:"Date:"}),e.jsx("p",{className:"text-slate-800 dark:text-slate-200",children:W(t.date)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-slate-500 dark:text-slate-400 text-sm",children:"Voucher Type:"}),e.jsx("p",{className:"text-sky-600 dark:text-sky-400 font-medium",children:t.type})]}),e.jsxs("div",{className:"col-span-2 md:col-span-1 md:text-right",children:[e.jsx("span",{className:"font-semibold text-slate-500 dark:text-slate-400 text-sm",children:"Voucher No:"}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300 font-mono text-lg",children:t.voucherNo})]})]}),e.jsxs("div",{className:"flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(m,{onClick:()=>Y(t.id),variant:"secondary",className:"!p-2",title:"Edit",children:e.jsx(K,{className:"w-5 h-5"})}),e.jsx(m,{onClick:()=>y([t.id]),variant:"danger",className:"!p-2",title:"Delete",children:e.jsx(S,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx("table",{className:"w-full text-sm",children:e.jsx("tbody",{children:Array.isArray(t.entries)&&t.entries.map((s,l)=>e.jsxs("tr",{children:[e.jsx("td",{className:`py-1 px-2 w-[10%] font-medium ${s.type==="Dr"?"text-green-600 dark:text-green-400":"text-orange-600 dark:text-orange-400"}`,children:s.type}),e.jsx("td",{className:"py-1 px-2 text-slate-800 dark:text-slate-200",children:u.get(s.ledgerId)||"Unknown"}),e.jsx("td",{className:"py-1 px-2 w-[30%] text-right font-mono text-slate-800 dark:text-slate-200",children:(Number(s.amount)||0).toFixed(2)})]},l))})})}),t.narration&&e.jsx("div",{className:"mt-3 pt-3 border-t border-slate-200 dark:border-slate-700/80",children:e.jsxs("p",{className:"text-sm text-slate-700 dark:text-slate-300",children:[e.jsx("span",{className:"font-semibold",children:"Narration:"})," ",t.narration]})})]})]},t.id))}):e.jsxs("div",{className:"text-center p-10",children:[e.jsx("h2",{className:"text-2xl font-bold text-sky-500 dark:text-sky-400 mb-4",children:"No Vouchers Found"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:x?"Your search returned no results.":"No entries were found for the selected period."})]})]})]})};export{se as default};
