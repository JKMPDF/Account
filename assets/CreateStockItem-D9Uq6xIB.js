import{r as o,C as M,b as D,c as q,j as e,S as A,B as C,m as G,n as O,E as F,o as H,p as K}from"./index-D93vVwhB.js";import{S as V}from"./stockUnits-D3SLr8Su.js";import{I as i}from"./Input-C3iYqBmf.js";import{T as I}from"./ToggleSwitch-B0PxrSpv.js";const P=()=>{const v=o.useContext(M),{addNotification:f}=D(),{showModal:S,hideModal:p}=q(),x={name:"",unit:"",hsnCode:"",gstRate:0,reorderLevel:0,isBatchTracked:!1,isSerialTracked:!1},[s,d]=o.useState(x),[r,u]=o.useState(null),[c,y]=o.useState("");if(o.useEffect(()=>{d(r?{...x,...r}:x)},[r]),!v)return null;const{companyData:a,addStockItem:T,editStockItem:w,deleteStockItem:E}=v,b=o.useMemo(()=>a!=null&&a.stockItems?c?a.stockItems.filter(t=>t.name.toLowerCase().includes(c.toLowerCase())):a.stockItems:[],[a==null?void 0:a.stockItems,c]),m=t=>{const{name:l,value:n,type:g}=t.target,h=g==="number";d(k=>({...k,[l]:h?parseFloat(n)||0:n}))},j=(t,l)=>{d(n=>({...n,[t]:l}))},L=t=>{if(t.preventDefault(),!s.name||!s.unit){f("Item Name and Unit are required.","error");return}let l=!1;if(r)l=w(r.id,s);else{if(a!=null&&a.stockItems.some(n=>n.name.toLowerCase()===s.name.toLowerCase())){f("A stock item with this name already exists.","error");return}l=!!T(s)}l&&u(null)},R=t=>{u(t),window.scrollTo(0,0)},N=()=>{u(null)},B=t=>{S(e.jsx(K,{title:"Delete Stock Item",message:`Are you sure you want to delete the item "${t.name}"? This action cannot be undone.`,onConfirm:()=>{(r==null?void 0:r.id)===t.id&&N(),E(t.id),p()},onCancel:p,confirmText:"Delete",confirmVariant:"danger"}))},U=o.useMemo(()=>[{value:"",label:"Select Unit"},...V.map(t=>({value:t.split(" ")[0],label:t}))],[]);return e.jsxs("div",{className:"container mx-auto grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-slate-100 mb-6",children:r?"Edit Stock Item":"Create Stock Item"}),e.jsxs("form",{onSubmit:L,className:"bg-white dark:bg-slate-800 p-6 rounded-lg shadow-lg border border-slate-200 dark:border-slate-700 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(i,{label:"Item Name",id:"name",name:"name",value:s.name,onChange:m,required:!0}),e.jsx(A,{label:"Unit",id:"unit",value:s.unit,onChange:t=>d(l=>({...l,unit:t})),options:U,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(i,{label:"HSN Code",id:"hsnCode",name:"hsnCode",value:s.hsnCode||"",onChange:m}),e.jsx(i,{label:"GST Rate (%)",id:"gstRate",name:"gstRate",type:"number",value:s.gstRate,onChange:m,min:"0",step:"0.01"}),e.jsx(i,{label:"Re-order Level",id:"reorderLevel",name:"reorderLevel",type:"number",value:s.reorderLevel,onChange:m,min:"0"})]}),e.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-700 pt-6 mt-6 space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-sky-500 dark:text-sky-400",children:"Inventory Tracking"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-6",children:[e.jsx(I,{label:"Track by Batch Number",id:"isBatchTracked",enabled:!!s.isBatchTracked,onChange:t=>j("isBatchTracked",t)}),e.jsx(I,{label:"Track by Serial Number",id:"isSerialTracked",enabled:!!s.isSerialTracked,onChange:t=>j("isSerialTracked",t)})]})]}),e.jsxs("div",{className:"flex justify-end items-center pt-4 gap-4",children:[r&&e.jsx(C,{type:"button",variant:"secondary",onClick:N,children:"Cancel"}),e.jsxs(C,{type:"submit",children:[e.jsx(G,{className:"w-5 h-5 mr-2"}),r?"Update Item":"Save Item"]})]})]})]}),e.jsxs("div",{className:"lg:col-span-1",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mb-6",children:"Existing Items"}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(i,{label:"",id:"search-item",type:"text",placeholder:"Search by name...",value:c,onChange:t=>y(t.target.value),className:"!pl-10 w-full"}),e.jsx(O,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"})]}),e.jsx("div",{className:"bg-white dark:bg-slate-800 p-4 rounded-lg shadow-lg border border-slate-200 dark:border-slate-700 max-h-[55vh] overflow-y-auto",children:b&&b.length>0?e.jsx("ul",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:b.map(t=>{const l=a.vouchers.some(n=>n.entries.some(g=>{var h;return(h=g.inventoryAllocations)==null?void 0:h.some(k=>k.stockItemId===t.id)}));return e.jsxs("li",{className:"py-3 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-slate-800 dark:text-slate-200",children:t.name}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:["Unit: ",t.unit," | GST: ",t.gstRate||0,"%"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>R(t),title:"Edit Item",className:"p-2 rounded-md text-slate-500 dark:text-slate-400 hover:text-sky-500 dark:hover:text-sky-400 hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors",children:e.jsx(F,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>B(t),disabled:l,title:l?"Cannot delete: Item is used in vouchers.":"Delete Item",className:"p-2 rounded-md text-slate-500 dark:text-slate-400 hover:text-red-500 hover:bg-slate-100 dark:hover:bg-slate-700 disabled:text-slate-400 dark:disabled:text-slate-600 disabled:hover:bg-transparent disabled:cursor-not-allowed transition-colors",children:e.jsx(H,{className:"w-5 h-5"})})]})]},t.id)})}):e.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-center py-4",children:"No stock items found."})})]})]})};export{P as default};
