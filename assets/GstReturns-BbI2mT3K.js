import{r as X,C as Z,d as tt,b as et,j as n,G as st,B as at}from"./index-D93vVwhB.js";import{f as M}from"./exportUtils-JZTId_Jh.js";const nt=(c,m)=>{const g=new Blob([m],{type:"application/json"}),r=URL.createObjectURL(g),s=document.createElement("a");s.download=c,s.href=r,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(r)},ot=(c,m,g)=>{var v,G,L;const{details:r,ledgers:s,stockItems:C,vouchers:U}=c,j=new Map(s.map(t=>[t.id,t])),V=new Map(C.map(t=>[t.id,t])),F=new Date(m),N=new Date(g);N.setHours(23,59,59,999);const R=`${(N.getMonth()+1).toString().padStart(2,"0")}${N.getFullYear()}`,P=U.filter(t=>{const o=new Date(t.date);return["Sale","Credit Note","Debit Note"].includes(t.type)&&o>=F&&o<=N}),k=[],w=[],l={},T=[],D=[],i={},I=t=>s.find(o=>o.name.toLowerCase()===t.toLowerCase()&&o.group==="Duties & Taxes"),Y=(v=I("cgst"))==null?void 0:v.id,H=(G=I("sgst"))==null?void 0:G.id,z=(L=I("igst"))==null?void 0:L.id;P.forEach(t=>{var A,_,B,E,J,$,q;const o=t.entries.find(a=>{var e;return["Sundry Debtors","Sundry Creditors"].includes(((e=j.get(a.ledgerId))==null?void 0:e.group)||"")});if(!o)return;const d=j.get(o.ledgerId);if(!d)return;const u=t.entries.find(a=>{var e;return["Sales Accounts","Purchase Accounts"].includes(((e=j.get(a.ledgerId))==null?void 0:e.group)||"")}),y=o.amount,p=(u==null?void 0:u.amount)||0,h=((A=t.entries.find(a=>a.ledgerId===Y))==null?void 0:A.amount)||0,S=((_=t.entries.find(a=>a.ledgerId===H))==null?void 0:_.amount)||0,x=((B=t.entries.find(a=>a.ledgerId===z))==null?void 0:B.amount)||0,W=h+S+x,f=p>0?parseFloat((W/p*100).toFixed(2)):0;(E=u==null?void 0:u.inventoryAllocations)==null||E.forEach(a=>{const e=V.get(a.stockItemId);if(e!=null&&e.hsnCode){i[e.hsnCode]||(i[e.hsnCode]={desc:e.name,uqc:e.unit,qty:0,val:0,txval:0,iamt:0,camt:0,samt:0,csamt:0});const b=a.quantity*a.rate;i[e.hsnCode].qty+=a.quantity,i[e.hsnCode].val+=b,i[e.hsnCode].txval+=b,t.transactionType==="Inter-State"?i[e.hsnCode].iamt+=b*((e.gstRate||0)/100):(i[e.hsnCode].camt+=b*((e.gstRate||0)/2/100),i[e.hsnCode].samt+=b*((e.gstRate||0)/2/100))}});const O=d.registrationType==="Registered"&&d.gstNo;if(t.type==="Sale")if(O)k.push({ctin:d.gstNo,inv:[{inum:t.voucherNo.toString(),idt:new Date(t.date).toLocaleDateString("en-GB").replace(/\//g,"-"),val:y,pos:((J=d.state)==null?void 0:J.substring(0,2))||"",rchrg:"N",inv_typ:"R",itms:[{num:1,itm_det:{txval:p,rt:f,iamt:x,camt:h,samt:S,csamt:0}}]}]});else if(t.transactionType==="Inter-State"&&y>25e4)w.push({pos:(($=d.state)==null?void 0:$.substring(0,2))||"",inv:[{inum:t.voucherNo.toString(),idt:new Date(t.date).toLocaleDateString("en-GB").replace(/\//g,"-"),val:y,itms:[{num:1,itm_det:{txval:p,rt:f,iamt:x,csamt:0}}]}]});else{const a=((q=d.state)==null?void 0:q.substring(0,2))||"97",e=`${a}|${f}|OE`;l[e]||(l[e]={sply_ty:t.transactionType==="Inter-State"?"INTER":"INTRA",pos:a,rt:f,typ:"OE",txval:0,iamt:0,camt:0,samt:0,csamt:0}),l[e].txval+=p,l[e].iamt+=x,l[e].camt+=h,l[e].samt+=S}else if(t.type==="Credit Note"||t.type==="Debit Note"){const a={nt_num:t.voucherNo.toString(),nt_dt:new Date(t.date).toLocaleDateString("en-GB").replace(/\//g,"-"),ntty:t.type==="Credit Note"?"C":"D",val:y,itms:[{num:1,itm_det:{txval:p,rt:f,iamt:x,camt:h,samt:S,csamt:0}}]};O?T.push({ctin:d.gstNo,nt:[a]}):D.push({typ:t.transactionType==="Inter-State"?"B2CL":"B2CS",...a})}});const K={gstin:r.gstNo,fp:R,gt:r.prevYearTurnover||0,cur_gt:Object.values(k).reduce((t,o)=>t+o.inv[0].val,0),b2b:k,b2cl:w,b2cs:Object.values(l),cdnr:T,cdnur:D,hsn:{data:Object.values(i)}},Q=`GSTR1_${r.gstNo}_${R}.json`;nt(Q,JSON.stringify(K,null,2))},dt=()=>{const c=X.useContext(Z),{startDate:m,endDate:g}=tt(),{addNotification:r}=et();if(!c)return null;const{companyData:s}=c,C=()=>{s?(ot(s,m,g),r("GSTR-1 JSON file generated successfully!","success")):r("Could not generate file. Company data not available.","error")};return n.jsxs("div",{className:"container mx-auto",children:[n.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-slate-100 mb-6",children:"GST Returns"}),n.jsxs("div",{className:"bg-white dark:bg-slate-800 p-8 rounded-lg shadow-lg border border-slate-200 dark:border-slate-700 max-w-2xl mx-auto text-center",children:[n.jsx("div",{className:"mx-auto bg-slate-100 dark:bg-slate-700 h-16 w-16 flex items-center justify-center rounded-full text-sky-500 dark:text-sky-400",children:n.jsx(st,{className:"w-8 h-8"})}),n.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-slate-200 mt-4",children:"Generate GSTR-1 JSON"}),n.jsx("p",{className:"text-slate-500 dark:text-slate-400 mt-2",children:"This tool will generate a GSTR-1 JSON file for the selected period, ready for upload to the GST portal."}),n.jsxs("div",{className:"my-6 bg-slate-100 dark:bg-slate-700/50 p-4 rounded-md",children:[n.jsx("p",{className:"font-semibold text-slate-700 dark:text-slate-300",children:"Selected Period:"}),n.jsxs("p",{className:"text-lg font-mono text-sky-500 dark:text-sky-400",children:[M(m)," to ",M(g)]})]}),n.jsx(at,{onClick:C,disabled:!(s!=null&&s.details.gstApplicable),children:s!=null&&s.details.gstApplicable?"Generate & Download JSON":"GST Not Applicable"}),!(s!=null&&s.details.gstApplicable)&&n.jsx("p",{className:"text-xs text-red-500 dark:text-red-400 mt-2",children:"Enable GST in Company Profile to use this feature."})]})]})};export{dt as default};
