import{f as c,n as le}from"./exportUtils-JZTId_Jh.js";const v=(t,i)=>{try{if(typeof jspdf>"u"||typeof jspdf.jsPDF>"u")throw new Error("PDF library (jspdf) is not loaded.");if(typeof jspdf.jsPDF.API.autoTable!="function")throw new Error("PDF table plugin (autotable) is not loaded.");t()}catch(e){console.error("Failed to generate PDF:",e),alert(`An error occurred while generating the PDF: ${e.message}`)}finally{}},l=t=>String(t??""),M=(t,i,e)=>{t.setFontSize(18),t.setFont(void 0,"bold"),t.text(l(i.name),105,15,{align:"center"}),t.setFontSize(10),t.setFont(void 0,"normal"),t.text(l(i.address),105,22,{align:"center"}),t.setFontSize(14),t.setFont(void 0,"bold"),t.text(l(e),105,35,{align:"center"}),t.setLineWidth(.5),t.line(15,38,195,38)},ee=(t,i,e,g=!1)=>{var J,k,K,Z;const{details:s,ledgers:p,stockItems:F,salesmen:f,invoiceCustomization:o}=i,r=new Map(p.map(a=>[a.id,a])),C=new Map(F.map(a=>[a.id,a])),n=new Map(f.map(a=>[a.id,a.name]));g?e.addPage():(e.addPage(),e.deletePage(1));const m=t.entries.find(a=>{var d;return["Sundry Debtors","Sundry Creditors","Bank Accounts","Cash-in-hand"].includes(((d=r.get(a.ledgerId))==null?void 0:d.group)||"")}),u=t.entries.find(a=>{var d;return((d=r.get(a.ledgerId))==null?void 0:d.group)===(t.type==="Sale"||t.type==="Credit Note"?"Sales Accounts":"Purchase Accounts")}),H=r.get((m==null?void 0:m.ledgerId)||""),B=e.internal.pageSize.getWidth(),ae=e.internal.pageSize.getHeight(),D=15,h=D,y=B-D,A=B-2*D,O=h,z=h+A/2,Y="#1E293B",N="#334155",$="#64748B",_="#E2E8F0";let S=20;if(e.setFont("Helvetica","bold"),e.setFontSize(16),e.setTextColor(Y),e.text("TAX INVOICE",y,S,{align:"right"}),o!=null&&o.logo)try{e.addImage(o.logo,"PNG",h,S-8,30,15,void 0,"FAST")}catch(a){console.error("Could not add logo",a)}S+=12,e.setDrawColor(_),e.setLineWidth(.5),e.line(h,S,y,S),S+=10;let L=S,x=S;e.setFont("Helvetica","bold"),e.setFontSize(9),e.setTextColor($),e.text("FROM:",O,L),L+=5,e.setFont("Helvetica","normal"),e.setFontSize(10),e.setTextColor(N);const U=[l(s.name).toUpperCase(),...e.splitTextToSize(l(s.address),A/2-5),`GSTIN: ${l(s.gstNo)}`,`PAN: ${l(s.panNo)}`,`Email: ${l(s.email)}`,`Phone: ${l(s.phone)}`].filter(a=>a&&!a.endsWith(": "));if(e.text(U,O,L),L+=U.length*5,H){e.setFont("Helvetica","bold"),e.setFontSize(9),e.setTextColor($),e.text("BILL TO:",z,x),x+=5,e.setFont("Helvetica","normal"),e.setFontSize(10),e.setTextColor(N);const a=[l(H.name),...e.splitTextToSize(l(H.address),A/2-5),`GSTIN: ${l(H.gstNo)||"N/A"}`].filter(Boolean);e.text(a,z,x),x+=a.length*5}x+=5,e.setDrawColor(_),e.line(z,x,y,x),x+=5;const j=[{label:"Invoice No.",value:l(t.voucherNo)},{label:"Invoice Date",value:c(t.date)}];t.originalInvoiceNo&&j.push({label:"Original Inv No.",value:l(t.originalInvoiceNo)}),t.salesmanId&&j.push({label:"Salesman",value:n.get(t.salesmanId)||""}),e.setFontSize(10),j.forEach(a=>{e.setFont("Helvetica","bold"),e.setTextColor(N),e.text(a.label,z,x),e.setFont("Helvetica","normal"),e.text(a.value,z+35,x),x+=6}),S=Math.max(L,x)+10;const q=[];(J=u==null?void 0:u.inventoryAllocations)==null||J.forEach((a,d)=>{const b=C.get(a.stockItemId);q.push([d+1,`${l(b==null?void 0:b.name)}
HSN: ${l(b==null?void 0:b.hsnCode)}`,l(b==null?void 0:b.unit),a.quantity.toFixed(2),a.rate.toFixed(2),(a.quantity*a.rate).toFixed(2)])}),e.autoTable({startY:S,head:[["#","ITEM & HSN","UNIT","QTY","RATE","AMOUNT"]],body:q,theme:"grid",headStyles:{fillColor:Y,textColor:255,fontStyle:"bold",halign:"center",fontSize:9},styles:{fontSize:9,cellPadding:2.5,valign:"middle"},columnStyles:{0:{halign:"center",cellWidth:10},3:{halign:"right"},4:{halign:"right"},5:{halign:"right"}},margin:{left:D,right:D}});let V=e.lastAutoTable.finalY;const E=((k=t.entries.find(a=>{var d;return((d=r.get(a.ledgerId))==null?void 0:d.name.toLowerCase())==="cgst"}))==null?void 0:k.amount)||0,G=((K=t.entries.find(a=>{var d;return((d=r.get(a.ledgerId))==null?void 0:d.name.toLowerCase())==="sgst"}))==null?void 0:K.amount)||0,R=((Z=t.entries.find(a=>{var d;return((d=r.get(a.ledgerId))==null?void 0:d.name.toLowerCase())==="igst"}))==null?void 0:Z.amount)||0,w=(m==null?void 0:m.amount)||0,ne=[{label:"Subtotal",value:(w-(E+G+R)).toFixed(2)},...E>0?[{label:"CGST",value:E.toFixed(2)}]:[],...G>0?[{label:"SGST",value:G.toFixed(2)}]:[],...R>0?[{label:"IGST",value:R.toFixed(2)}]:[]];let T=V+8;const W=y-60,X=y;e.setFontSize(10),ne.forEach(a=>{e.setFont("Helvetica","normal"),e.setTextColor(N),e.text(a.label,W,T,{align:"left"}),e.text(a.value,X,T,{align:"right"}),T+=6}),T+=2,e.setLineWidth(.5),e.line(W-2,T,y,T),T+=6,e.setFont("Helvetica","bold"),e.setFontSize(10.5),e.setTextColor(Y),e.text("GRAND TOTAL",W,T,{align:"left"}),e.text(s.currencySymbol+" "+w.toFixed(2),X,T,{align:"right"});let P=V+10;e.setFontSize(9),e.setTextColor($),e.text("Total Amount in Words:",h,P),e.setFont("Helvetica","normal"),e.setTextColor(N);const Q=e.splitTextToSize(le(w),A/2-10);if(e.text(Q,h,P+5),P+=Q.length*4+5,s.upiId&&w>0){P=Math.max(P,T)+10;try{const a=`upi://pay?pa=${s.upiId}&pn=${encodeURIComponent(s.name)}&am=${w.toFixed(2)}&cu=INR`,d=document.createElement("div");d.style.display="none",document.body.appendChild(d),new QRCode(d,{text:a,width:96,height:96,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.M});const b=d.querySelector("canvas");if(b){const oe=b.toDataURL("image/png");e.setFontSize(9),e.setTextColor($),e.text("Scan to Pay:",h,P),e.addImage(oe,"PNG",h,P+2,30,30),P+=35}document.body.removeChild(d)}catch(a){console.error("Failed to generate QR Code:",a)}}let I=ae-D;if(e.setFont("Helvetica","bold"),e.text(`For ${s.name}`,y,I-15,{align:"right"}),e.text("Authorised Signatory",y,I,{align:"right"}),o!=null&&o.terms){I-=25,e.setDrawColor(_),e.line(h,I-2,y,I-2),e.setFontSize(8),e.setTextColor($),e.text("Terms & Conditions:",h,I),e.setFont("Helvetica","normal"),e.setTextColor(N);const a=e.splitTextToSize(o.terms,A);e.text(a,h,I+4)}},te=(t,i,e,g=!1)=>{const{details:s,ledgers:p}=i,F=new Map(p.map(n=>[n.id,n]));g?e.addPage():(e.addPage(),e.deletePage(1)),M(e,s,t.type),e.setFontSize(10),e.setFont(void 0,"bold"),e.text("Voucher No:",15,45),e.setFont(void 0,"normal"),e.text(l(t.voucherNo),45,45),e.setFont(void 0,"bold"),e.text("Date:",150,45),e.setFont(void 0,"normal"),e.text(c(t.date),165,45);const f=t.entries.map(n=>{var m;return[n.type,l((m=F.get(n.ledgerId))==null?void 0:m.name),n.type==="Dr"?n.amount.toFixed(2):"",n.type==="Cr"?n.amount.toFixed(2):""]}),o=t.entries.filter(n=>n.type==="Dr").reduce((n,m)=>n+m.amount,0).toFixed(2),r=t.entries.filter(n=>n.type==="Cr").reduce((n,m)=>n+m.amount,0).toFixed(2);e.autoTable({startY:55,head:[["Dr/Cr","Particulars","Debit","Credit"]],body:f,theme:"grid",foot:[["","Total",o,r]],footStyles:{fontStyle:"bold"},styles:{fontSize:9},columnStyles:{2:{halign:"right"},3:{halign:"right"}}});let C=e.lastAutoTable.finalY;t.narration&&(e.setFont(void 0,"bold"),e.text("Narration:",15,C+10),e.setFont(void 0,"normal"),e.text(e.splitTextToSize(l(t.narration),180),15,C+15))},re=(t,i)=>{v(()=>{const{jsPDF:e}=jspdf,g=new e("p","mm","a4");["Sale","Purchase","Credit Note","Debit Note"].includes(t.type)?ee(t,i,g):te(t,i,g);const s=l(i.details.name).replace(/[^a-z0-9]/gi,"_").toLowerCase();g.save(`voucher_${t.type.replace(" ","_")}_${t.voucherNo}_${s}.pdf`)})},de=(t,i)=>{v(()=>{const{jsPDF:e}=jspdf,g=new e("p","mm","a4");g.deletePage(1),t.forEach(p=>{["Sale","Purchase","Credit Note","Debit Note"].includes(p.type)?ee(p,i,g,!0):te(p,i,g,!0)});const s=l(i.details.name).replace(/[^a-z0-9]/gi,"_").toLowerCase();g.save(`vouchers_export_${s}.pdf`)})},ge=(t,i,e,g,s,p,F)=>{v(()=>{const{jsPDF:f}=jspdf,o=new f(e.length>7?"landscape":"portrait");M(o,F.details,`Ledger Report: ${l(t.name)}`),o.setFontSize(10),o.text(`Period: ${c(s)} to ${c(p)}`,o.internal.pageSize.getWidth()/2,45,{align:"center"});const r=[e.map(n=>n.label)],C=i.map(n=>e.map(m=>{let u=n[m.id];return m.id==="date"?c(u):m.id==="balance"&&typeof u=="number"?`${Math.abs(u).toFixed(2)} ${u>=0?"Dr":"Cr"}`:typeof u=="number"?u.toFixed(2):l(u)}));o.autoTable({startY:55,head:r,body:[e.map(n=>n.id==="particulars"?"Opening Balance":n.id==="balance"?`${Math.abs(g).toFixed(2)} ${g>=0?"Dr":"Cr"}`:""),...C],theme:"grid",styles:{fontSize:8}}),o.save(`Ledger_${l(t.name).replace(/ /g,"_")}.pdf`)})},me=(t,i,e,g,s)=>{v(()=>{const{jsPDF:p}=jspdf,F=new p;M(F,s.details,"Trial Balance"),F.setFontSize(10),F.text(`As on: ${c(g)}`,105,45,{align:"center"});const f=t.map(o=>[l(o.name),o.debit>0?o.debit.toFixed(2):"",o.credit>0?o.credit.toFixed(2):""]);F.autoTable({startY:55,head:[["Particulars","Debit","Credit"]],body:f,foot:[["Total",i.toFixed(2),e.toFixed(2)]],theme:"grid",footStyles:{fontStyle:"bold"},columnStyles:{1:{halign:"right"},2:{halign:"right"}}}),F.save("trial_balance.pdf")})},fe=(t,i,e,g,s,p,F,f)=>{v(()=>{const{jsPDF:o}=jspdf,r=new o;M(r,f.details,"Profit & Loss Statement"),r.setFontSize(10),r.text(`Period: ${c(p)} to ${c(F)}`,105,45,{align:"center"}),r.autoTable({startY:55,head:[["Expenses","Amount"]],body:i.map(n=>[l(n.name),n.balance.toFixed(2)]),foot:[["Total Expenses",g.toFixed(2)]],theme:"striped",footStyles:{fontStyle:"bold"},columnStyles:{1:{halign:"right"}},margin:{right:107}}),r.autoTable({startY:55,head:[["Incomes","Amount"]],body:t.map(n=>[l(n.name),n.balance.toFixed(2)]),foot:[["Total Incomes",e.toFixed(2)]],theme:"striped",footStyles:{fontStyle:"bold"},columnStyles:{1:{halign:"right"}},margin:{left:107}});let C=Math.max(r.lastAutoTable.finalY,r.previousAutoTable.finalY);r.setFontSize(12),r.setFont(void 0,"bold"),r.text(`${s>=0?"Net Profit":"Net Loss"}: ${Math.abs(s).toFixed(2)}`,105,C+15,{align:"center"}),r.save("profit_and_loss.pdf")})},pe=(t,i,e,g,s,p)=>{v(()=>{const{jsPDF:F}=jspdf,f=new F;M(f,p.details,"Balance Sheet"),f.setFontSize(10),f.text(`As on: ${c(s)}`,105,45,{align:"center"}),f.autoTable({startY:55,head:[["Liabilities & Equity","Amount"]],body:t.map(o=>[l(o.head),o.total.toFixed(2)]),foot:[["Total Liabilities",e.toFixed(2)]],theme:"striped",footStyles:{fontStyle:"bold"},columnStyles:{1:{halign:"right"}},margin:{right:107}}),f.autoTable({startY:55,head:[["Assets","Amount"]],body:i.map(o=>[l(o.head),o.total.toFixed(2)]),foot:[["Total Assets",g.toFixed(2)]],theme:"striped",footStyles:{fontStyle:"bold"},columnStyles:{1:{halign:"right"}},margin:{left:107}}),f.save("balance_sheet.pdf")})};export{de as a,pe as b,fe as c,ge as d,me as e,re as g};
